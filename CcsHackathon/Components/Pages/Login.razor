@page "/login"
@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Authentication.OpenIdConnect
@using CcsHackathon.Services
@inject NavigationManager Navigation
@inject IHttpContextAccessor HttpContextAccessor
@inject IConfiguration Configuration
@inject IUserContext UserContext
@attribute [AllowAnonymous]

<PageTitle>Login</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    @if (useDummyAuth)
                    {
                        <h2 class="card-title mb-4">Dummy Authentication Mode</h2>
                        <p class="card-text mb-4">You are automatically logged in as a demo user.</p>
                        <p class="text-muted small mb-4">To use real Microsoft authentication, set <code>Features:UseDummyAuth</code> to <code>false</code> in appsettings.json</p>
                        <a href="/register-game" class="btn btn-primary">Continue</a>
                    }
                    else
                    {
                        <h2 class="card-title mb-4">Sign in with Microsoft</h2>
                        <p class="card-text mb-4">Please sign in to access the application.</p>
                        <a href="/MicrosoftIdentity/Account/SignIn" class="btn btn-primary">Sign In</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private bool useDummyAuth = true;

    protected override void OnInitialized()
    {
        useDummyAuth = Configuration.GetValue<bool>("Features:UseDummyAuth", true);
        
        // If already authenticated, redirect to register game page
        if (UserContext.IsAuthenticated)
        {
            Navigation.NavigateTo("/register-game", forceLoad: true);
        }
    }
}

